---
resources:
- name: github
  type: git
  source:
    uri: https://github.com/jschirrmacher/Rocket.Chat.git
    branch: develop

jobs:
- name: build
  public: true
  plan:

  - get: github
    trigger: true

  - task: install
    config:
      platform: linux
      image_resource:
        type: docker-image
        source: {repository: node, tag: carbon}
      inputs:
        - name: github
      caches:
        - path: /root/.meteor/./scripts/admin
      outputs:
        - name: installed
      run:
        path: github/.concourse/install.sh

  - task: lint
    config:
      platform: linux
      image_resource:
        type: docker-image
        source: {repository: node, tag: carbon}
      inputs:
        - name: installed
      run:
        path: meteor npm run lint

  - task: stylelint
    config:
      platform: linux
      image_resource:
        type: docker-image
        source: {repository: node, tag: carbon}
      inputs:
        - name: installed
      run:
        path: meteor npm run stylelint

  - task: unittests
    config:
      platform: linux
      image_resource:
        type: docker-image
        source: {repository: node, tag: carbon}
      inputs:
        - name: installed
      run:
        path: meteor npm run testunit
